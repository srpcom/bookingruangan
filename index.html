<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Booking Ruang Rapat - RSUD dr. R. Koesma</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --iron-red: #c82a1d;
            --iron-gold: #f8d452;
            --arc-blue: #00b8ff;
            --dark-bg: #101419;
            --text-light: #f0f0f0;
        }

        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 1rem; /* Padding untuk mobile */
            min-height: 100vh;
            color: var(--text-light);
            background: 
                linear-gradient(rgba(16, 20, 25, 0.85), rgba(16, 20, 25, 0.85)),
                url('https://raw.githubusercontent.com/srpcom/bookingruangan/main/photo_2025-07-11_16-49-46.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }

        .container {
            max-width: 1200px;
            margin: auto;
            padding: 0;
        }

        header {
            text-align: center;
            margin-bottom: 2rem;
        }

        header h1 {
            font-size: 2rem;
            color: var(--iron-gold);
            text-shadow: 2px 2px 8px rgba(0,0,0,0.7);
            margin: 0;
        }

        header p {
            font-size: 1rem;
            color: var(--text-light);
            opacity: 0.9;
        }

        /* --- Tata Letak Utama (Mobile First) --- */
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 2rem; /* Jarak antara form dan jadwal */
        }

        /* --- Efek Glassmorphism --- */
        .glass-card {
            background: rgba(20, 30, 40, 0.75);
            backdrop-filter: blur(12px) saturate(180%);
            -webkit-backdrop-filter: blur(12px) saturate(180%);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            padding: 1.5rem;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }

        .form-card h2, .schedule-card h2 {
            color: var(--iron-gold);
            border-bottom: 2px solid var(--iron-red);
            padding-bottom: 0.5rem;
            margin-top: 0;
            font-size: 1.5rem;
        }

        .form-group { margin-bottom: 1rem; }
        .form-group label { display: block; margin-bottom: 0.5rem; font-weight: 500; }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background-color: rgba(0,0,0,0.3);
            color: var(--text-light);
            font-size: 1rem;
            box-sizing: border-box;
            transition: all 0.3s ease;
        }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: var(--arc-blue);
            box-shadow: 0 0 10px var(--arc-blue);
        }
        .form-group textarea { resize: vertical; min-height: 80px; }

        .btn-submit {
            width: 100%;
            padding: 0.8rem 1rem;
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-light);
            background: linear-gradient(45deg, var(--iron-red), #a01010);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
        }
        .btn-submit:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(200, 42, 29, 0.4); }
        .btn-submit:disabled { background: #555; cursor: not-allowed; opacity: 0.7; }

        .schedule-rooms {
            display: grid;
            grid-template-columns: 1fr; /* Satu kolom di mobile */
            gap: 1.5rem;
        }

        .room-column { background: rgba(0,0,0,0.2); border-radius: 10px; padding: 1rem; }
        .room-column h3 { margin-top: 0; color: var(--arc-blue); text-align: center; }

        .booking-item {
            background: rgba(10, 20, 30, 0.5);
            padding: 0.75rem;
            border-radius: 5px;
            margin-bottom: 0.75rem;
            border-left: 4px solid var(--iron-gold);
            font-size: 0.9rem;
        }
        .booking-item p { margin: 0.3rem 0; }
        .booking-item .keperluan { font-weight: bold; color: var(--iron-gold); }
        .booking-item .peminjam { font-style: italic; opacity: 0.8; }

        /* Modal Notifikasi */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.6); animation: fadeIn 0.3s; }
        .modal-content { position: relative; margin: 30% auto; padding: 25px; width: 90%; max-width: 500px; text-align: center; }
        .modal-content.success { border-top: 5px solid var(--arc-blue); }
        .modal-content.error { border-top: 5px solid var(--iron-red); }
        .close-button { color: #aaa; position: absolute; top: 10px; right: 20px; font-size: 28px; font-weight: bold; cursor: pointer; }
        @keyframes fadeIn { from {opacity: 0} to {opacity: 1} }

        /* --- Tampilan Desktop (Layar Lebih Lebar) --- */
        @media (min-width: 992px) {
            body {
                padding: 2rem;
            }
            .container {
                padding: 2rem;
            }
            header h1 {
                font-size: 2.5rem;
            }
            .main-content {
                display: grid;
                grid-template-columns: 400px 1fr;
                gap: 2rem;
            }
            .schedule-rooms {
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            }
        }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>Sistem Booking Ruang Rapat</h1>
            <p>RSUD dr. R. Koesma Tuban</p>
        </header>

        <div class="main-content">
            <div class="form-card glass-card">
                <h2>Buat Booking Baru</h2>
                <form id="bookingForm">
                    <div class="form-group">
                        <label for="namaRuangan">Pilih Ruangan</label>
                        <select id="namaRuangan" name="namaRuangan" required>
                            <option value="Gajah Mada">Gajah Mada</option>
                            <option value="Ronggolawe">Ronggolawe</option>
                            <option value="Aryo Tejo">Aryo Tejo</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="namaPeminjam">Nama Peminjam</label>
                        <input type="text" id="namaPeminjam" name="namaPeminjam" required>
                    </div>
                    <div class="form-group">
                        <label for="unitBagian">Unit / Bagian</label>
                        <input type="text" id="unitBagian" name="unitBagian" required>
                    </div>
                    <div class="form-group">
                        <label for="tanggalMulai">Tanggal & Waktu Mulai</label>
                        <input type="datetime-local" id="tanggalMulai" name="tanggalMulai" required>
                    </div>
                    <div class="form-group">
                        <label for="tanggalSelesai">Tanggal & Waktu Selesai</label>
                        <input type="datetime-local" id="tanggalSelesai" name="tanggalSelesai" required>
                    </div>
                    <div class="form-group">
                        <label for="keperluan">Keperluan</label>
                        <textarea id="keperluan" name="keperluan" required></textarea>
                    </div>
                    <button type="submit" class="btn-submit" id="submitButton">Booking Sekarang</button>
                </form>
            </div>
            <div class="schedule-card glass-card">
                <h2>Jadwal Penggunaan Ruangan</h2>
                <div id="scheduleContainer" class="schedule-rooms">
                    <p id="loadingMessage">Memuat jadwal...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Notification -->
    <div id="notificationModal" class="modal">
        <div id="modalContent" class="modal-content glass-card">
            <span class="close-button">&times;</span>
            <p id="modalMessage"></p>
        </div>
    </div>

    <script>
        // URL Web App Google Apps Script Anda.
        const GAS_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbyRSj_mjQ15k0W_5C640ft3QCsCrhjTSM4Pl9jG1pW6Hw3vMTj0DVSmgh4JeALWUw/exec';

        const rooms = ["Gajah Mada", "Ronggolawe", "Aryo Tejo"];
        const form = document.getElementById('bookingForm');
        const submitButton = document.getElementById('submitButton');
        const scheduleContainer = document.getElementById('scheduleContainer');
        const loadingMessage = document.getElementById('loadingMessage');
        
        // Modal elements
        const modal = document.getElementById('notificationModal');
        const modalContent = document.getElementById('modalContent');
        const modalMessage = document.getElementById('modalMessage');
        const closeButton = document.querySelector('.close-button');

        // --- Modal Logic ---
        function showModal(message, type = 'success') {
            modalMessage.textContent = message;
            modalContent.className = 'modal-content glass-card ' + type;
            modal.style.display = 'block';
        }
        closeButton.onclick = () => modal.style.display = 'none';
        window.onclick = (event) => {
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        }

        // --- Data Fetching and Rendering ---
        async function fetchSchedule() {
            loadingMessage.style.display = 'block';
            scheduleContainer.innerHTML = ''; // Clear previous content
            
            try {
                const response = await fetch(GAS_WEB_APP_URL);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const result = await response.json();

                if (result.status === 'success') {
                    renderSchedule(result.data);
                } else {
                    throw new Error(result.message || 'Gagal mengambil data dari Google Sheets.');
                }
            } catch (error) {
                console.error('Error fetching schedule:', error);
                scheduleContainer.innerHTML = `<p style="color:var(--iron-red);">Gagal memuat jadwal. Pastikan URL Web App benar dan sudah di-deploy dengan benar.</p>`;
            } finally {
                loadingMessage.style.display = 'none';
            }
        }

        function renderSchedule(data) {
            scheduleContainer.innerHTML = ''; // Clear again to be safe

            data.sort((a, b) => new Date(`${a['Tanggal Mulai']}T${a['Waktu Mulai']}`) - new Date(`${b['Tanggal Mulai']}T${b['Waktu Mulai']}`));

            rooms.forEach(room => {
                const roomColumn = document.createElement('div');
                roomColumn.className = 'room-column';
                
                const roomTitle = document.createElement('h3');
                roomTitle.textContent = room;
                roomColumn.appendChild(roomTitle);

                const bookingsForRoom = data.filter(booking => booking['Nama Ruangan'] === room && booking['Status'] === 'Booked');

                if (bookingsForRoom.length === 0) {
                    const noBooking = document.createElement('p');
                    noBooking.textContent = 'Belum ada jadwal.';
                    noBooking.style.opacity = '0.6';
                    noBooking.style.textAlign = 'center';
                    roomColumn.appendChild(noBooking);
                } else {
                    bookingsForRoom.forEach(booking => {
                        const item = document.createElement('div');
                        item.className = 'booking-item';
                        
                        const startDate = new Date(`${booking['Tanggal Mulai']}T${booking['Waktu Mulai']}`);
                        const endDate = new Date(`${booking['Tanggal Selesai']}T${booking['Waktu Selesai']}`);
                        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };

                        item.innerHTML = `
                            <p class="keperluan">${booking['Keperluan']}</p>
                            <p class="peminjam">Oleh: ${booking['Nama Peminjam']} (${booking['Unit/Bagian']})</p>
                            <p><strong>Mulai:</strong> ${startDate.toLocaleDateString('id-ID', options)} ${booking['Waktu Mulai']}</p>
                            <p><strong>Selesai:</strong> ${endDate.toLocaleDateString('id-ID', options)} ${booking['Waktu Selesai']}</p>
                        `;
                        roomColumn.appendChild(item);
                    });
                }
                scheduleContainer.appendChild(roomColumn);
            });
        }

        // --- Form Submission ---
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const startDateTimeValue = document.getElementById('tanggalMulai').value;
            const endDateTimeValue = document.getElementById('tanggalSelesai').value;

            if (!startDateTimeValue || !endDateTimeValue) {
                showModal('Harap isi tanggal dan waktu mulai dan selesai.', 'error');
                return;
            }

            const startDateTime = new Date(startDateTimeValue);
            const endDateTime = new Date(endDateTimeValue);

            if (endDateTime <= startDateTime) {
                showModal('Waktu selesai harus setelah waktu mulai.', 'error');
                return;
            }

            submitButton.disabled = true;
            submitButton.textContent = 'Mengirim...';

            const formData = new FormData(form);
            const bookingData = {
                namaRuangan: formData.get('namaRuangan'),
                namaPeminjam: formData.get('namaPeminjam'),
                unitBagian: formData.get('unitBagian'),
                tanggalMulai: startDateTime.toISOString().split('T')[0],
                waktuMulai: startDateTime.toTimeString().split(' ')[0].substring(0,5),
                tanggalSelesai: endDateTime.toISOString().split('T')[0],
                waktuSelesai: endDateTime.toTimeString().split(' ')[0].substring(0,5),
                keperluan: formData.get('keperluan'),
            };

            try {
                const response = await fetch(GAS_WEB_APP_URL, {
                    method: 'POST',
                    redirect: 'follow',
                    headers: { 'Content-Type': 'text/plain;charset=utf-8' },
                    body: JSON.stringify(bookingData)
                });

                const result = await response.json();

                if (result.status === 'success') {
                    showModal(result.message, 'success');
                    form.reset();
                    fetchSchedule();
                } else {
                    showModal(result.message, 'error');
                }

            } catch (error) {
                console.error('Error submitting form:', error);
                showModal('Gagal mengirim booking. Cek koneksi internet atau hubungi administrator.', 'error');
            } finally {
                submitButton.disabled = false;
                submitButton.textContent = 'Booking Sekarang';
            }
        });

        // Initial load
        document.addEventListener('DOMContentLoaded', fetchSchedule);
    </script>
</body>
</html>
